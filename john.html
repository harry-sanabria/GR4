<html>
	<head>
		<link href="bootstrap-3.1.1-dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="john.css" rel="stylesheet">
		<link rel="stylesheet" href="jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.css">
	    <script src="jquery-ui-1.10.4.custom/js/jquery-1.10.2.js"></script>
	    <script src="jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.js"></script>
	    <script src="bootstrap-3.1.1-dist/js/bootstrap.min.js"></script>
	    <script src="http://code.highcharts.com/highcharts.js"></script>
            <script src="http://code.highcharts.com/modules/exporting.js"></script>
	    <script>
	    	$(function () {

	    		var medicines_img = $("#medicines-img");

	    		var selected_metric = "pressure";
	    		
	    		var generate_graph = function (yaxis, xaxis) {
	    			var series;
	    			if (yaxis === 'mmHg') {
	    				//get blood pressure data
	    				if (xaxis === '1 year') {
	    				        series = [{
                					name: 'Systolic',
                					data: [135, 120, 155, 150, 150, 140, 155, 150, 160, 155, 155, 160],
                                                        color: 'blue'
            					}, {
                					name: 'Diastolic',
                					data: [75, 65, 70, 60, 75, 70, 60, 80, 75, 70, 60, 70],
                					color: 'red'
            					}]
	    				} else if (xaxis === '6 months') {
	    				        series = [{
                					name: 'Systolic',
                					data: [155, 150, 160, 155, 155, 160],
                                                        color: 'blue'
            					}, {
                					name: 'Diastolic',
                					data: [60, 80, 75, 70, 60, 70],
                					color: 'red'
            					}]
	    				}
	    			}
	    			else if (yaxis === 'bpm') {
	    				//get heart rate data
	    				if (xaxis === '1 year') {
	    				        series = [{
	    				        	name: '',
                					data: [65, 70, 65, 75, 100, 105, 70, 75, 70, 70, 70, 70]
            					}]
	    				} else if (xaxis === '6 months') {
	    				        series = [{
	    				        	name: '',
                					data: [70, 75, 70, 70, 70, 70]
            					}]
	    				}
	    			}
	    			else if (yaxis === 'lbs') {
	    				//get weight data
	    				if (xaxis === '1 year') {
	    				        series = [{
	    				        	name: '',
                					data: [150, 155, 160, 170, 165, 155, 155, 160, 160, 155, 160, 165]
            					}]
	    				} else if (xaxis === '6 months') {
	    				        series = [{
	    				        	name: '',
                					data: [155, 160, 160, 155, 160, 165]
            					}]
	    				}
	    			}
	    			var categories;
	    			if (xaxis === '1 year') {
	    			        categories = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
	    			}
	    			else if (xaxis === '6 months') {
	    			        categories = ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
	    			}
	    			$(function () {
                                        $('#graph-container').highcharts({
                                                title: {
                                                        text: '',
                                                        x: -20 //center
                                                },
                                                xAxis: {
                                                        categories: categories
                                                },
                                                yAxis: {
                                                        title: {
                                                                text: yaxis
                                                        },
                                                        plotLines: [{
                                                                value: 0,
                                                                width: 1,
                                                                color: '#808080'
                                                        }]
                                                },
                                                tooltip: {
                                                        valueSuffix: yaxis
                                                },
                                                legend: {
                                                        layout: 'vertical',
                                                        align: 'right',
                                                        verticalAlign: 'middle',
                                                        borderWidth: 0
                                                },
                                                series: series
                                        });
                                });
	    		};
	    		
	    		generate_graph('mmHg', '1 year');

	    		$('#bp').click(function (e) {
	    			$(this).addClass('selected');
	    			$('#hr').removeClass('selected');
	    			$('#w').removeClass('selected');

	    			selected_metric = "pressure";

	    			//change graph
	    			generate_graph('mmHg', getTimeSelection());

	    		});

	    		$('#bp').mousedown(function(e){
	    			e.preventDefault();
	    		});

	    		$('#hr').click(function (e) {
	    			$(this).addClass('selected');
	    			$('#bp').removeClass('selected');
	    			$('#w').removeClass('selected');

	    			selected_metric = "bpm";

	    			//change graph
	    			generate_graph('bpm', getTimeSelection());	    			
	    		});

	    		$('#hr').mousedown(function(e){
	    			e.preventDefault();
	    		});

	    		$('#w').click(function (e) {
	    			$(this).addClass('selected');
	    			$('#hr').removeClass('selected');
	    			$('#bp').removeClass('selected');

	    			selected_metric = "weight";

	    			//change graph
	    			generate_graph('lbs', getTimeSelection());
	    		});

	    		$('#w').mousedown(function(e){
	    			e.preventDefault();
	    		});

	    		$('#timeselect').change(function (e) {

	    			//change graph

	    			generate_graph(selected_metric, getTimeSelection());
	    			if (getTimeSelection === '1 year') {
	    				medicines_img.attr("src", "images/medicines_year.png");
	    			}
	    			else if (getTimeSelection === '6 months') {
	    				medicines_img.attr("src", "images/medicines_6mo.png");
	    			}
	    			e.preventDefault();

	    		});

	    		$('#timeselect').click(function (e) {
	    			e.preventDefault();
	    		});

	    		$('#backbutton').click(function () {
	    			window.location = "search.html";
	    		});

	    		$('#alert').delay(500).fadeIn(500);

	    		$('.disabled').click(function (e) {
	    			e.preventDefault();
	    		});

	    		$('.popover-markup>.trigger').popover({
    				html: true,
    				title: function () {
        				return $(this).parent().find('.head').html();
    				},
    				content: function () {
        				return $(this).parent().find('.content').html();
    				}
				}).on('click', function(e) {

					$('.popover').on('click', function(e) {
			            e.stopPropagation(); 
			        });

			        $('.popover').on('click', '#addmed', function(e) {
			        	$('#benadryl').removeClass('hide');
						$('#prescribe').popover('hide');
			            e.stopPropagation(); 
			        });

        			e.stopPropagation();
    			});

    			function getTimeSelection() {

    				var time_string =  $("#timeselect").val() == 1 ? "1 year" : "6 months";

    				return time_string;
    			}

				$(document).on('click', function() {
        			$('#prescribe').popover('hide');
    			});

	    	});
	    </script>
	</head>

	<body>
		<div id="maindiv">

			<nav id="patientnav" class="navbar navbar-default" role="navigation">
				<div class="container-fluid">
    				<div class="navbar-header">
      					<a class="navbar-brand" href="search.html">Health Monitor</a>
    				</div>
				</div>
			</nav>

			<div id="alert" class="alert alert-warning">
      			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">x</button>
				John Doe has an elevated heart rate, which may be due to his Benadryl prescription.
    		</div>

			<br>

			<div id="contentdiv">
				<input id="backbutton" type="button" class="btn btn-primary" value="Back">
				<table id="patientinfo">
					<tr>
						<th>&nbsp;</th>
						<th>John Doe</th>
						<th>&nbsp;</th>
					</tr>
					<tr>
						<td>Age: 21</td>
						<td>Blood Type: B-</td>
						<td>Gender: M</td>
					</tr>
				</table>

				<br>

				<div class="fixwidth">
					<div class="btn-group btn-group-justified">
						<div class="btn-group">
	  						<button id="bp" type="button" class="btn btn-default selected">Blood Pressure</button>
	  					</div>
	  					<div class="btn-group">
	  						<button id="hr" type="button" class="btn btn-default">Heart Rate</button>
	  					</div>
	  					<div class="btn-group">
	  						<button id="w" type="button" class="btn btn-default">Weight</button>
	  					</div>
					</div>
				</div>

				<br><br>
				<div id="graphs-wrapper">
					<div id="graphs">
						<div id="graph-container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
					</div>
					<img id="medicines-img" src="images/medicines_year.png" alt="Medicines">
				<div>

				<br>

				<select id="timeselect" class="form-control">
					<option value="1">1 year</option>
					<option value="2">6 months</option>
				</select>

				<br><br><br>

				<div id="medications">

					<table id="medtable" class="table">
						<thead>
							<tr>
								<th colspan="5" class="theader bigfont center">Current Medications</th>
								<td colspan="2" class="theader">
									<div class="popover-markup"> 
										<button id="prescribe" type="button popover-markup" class="btn btn-primary trigger" data-placement="top">Prescribe New</button>
    									<div class="head hide">Prescribe New Medication</div>
    									<div class="content hide">
	        								<div class="form-group">
	            								<input type="text" class="form-control norm" size="56" placeholder="Name of Medication">
	            								<input type="text" class="form-control norm" size="4" placeholder="0">
	            								<select class="form-control norm">
													<option value="1">ml</option>
													<option value="2">mg</option>
													<option value="3">tbsp</option>
												</select>
												per
	            								<input type="text" class="form-control norm" size="4" placeholder="0">
	            								<select class="form-control norm">
													<option value="1">hrs</option>
													<option value="2">days</option>
													<option value="3">weeks</option>
												</select>	 
	            								<input type="text" class="form-control norm" size="56" placeholder="Reason">
												<textarea class="form-control norm" cols="58" placeholder="Comment..."></textarea> 
	        									<button id="addmed" type="button" class="btn btn-default btn-block">Add</button>
											</div>
   	 									</div>
									</div>
								</td>
							</tr>
							<tr>
								<th>&nbsp;</th>
								<th>&nbsp;</th>
								<th>Name</th>
								<th>Dose</th>
								<th>Prescribed By</th>
								<th>Reason</th>
								<th>Comment</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<a href="#" class="disabled">edit</a>
								</td>
								<td>
									<a href="#" class="disabled">remove</a>
								</td>
								<td>Tylenol</td>
								<td>100mg/24hrs</td>
								<td>Dr. No</td>
								<td>Headache</td>
								<td></td>
							</tr>
							<tr>
								<td>
									<a href="#" class="disabled">edit</a>
								</td>
								<td>
									<a href="#" class="disabled">remove</a>
								</td>
								<td>Pepto-Bismol</td>
								<td>30ml/hr</td>
								<td>Dr. Tran</td>
								<td>Stomach ache</td>
								<td></td>
							</tr>
							<tr id="benadryl" class="hide">
								<td>
									<a href="#" class="disabled">edit</a>
								</td>
								<td>
									<a href="#" class="disabled">remove</a>
								</td>
								<td>Benadryl</td>
								<td>50mg/24hr</td>
								<td>Dr. Tran</td>
								<td>Allergy</td>
								<td></td>
							</tr>						
						</tbody>
					</table>

				</div>

				<br><br><br>

			</div>
		</div>
	</body>
</html>
